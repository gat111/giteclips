# 商品検索、カート、購入処理の分岐網羅（Branch Coverage）

## 1. 商品検索処理（ProductAction）

### 分岐1: if (keyword==null)

| テストケースID | 分岐 | 入力条件 | 期待される実行パス | 期待結果 |
|---------------|------|----------|-------------------|----------|
| TC-BR-PROD-01 | true | keyword=null | keyword=""に設定 | 空文字列で検索実行 |
| TC-BR-PROD-02 | false | keyword="商品名" | keywordをそのまま使用 | 入力値で検索実行 |

### 実行パス網羅

| 実行パス | 通過する分岐 | 入力条件 | 期待結果 |
|---------|-------------|----------|----------|
| パス1 | keyword==null (true) | 検索キーワードなし | 全商品検索 |
| パス2 | keyword==null (false) | 検索キーワードあり | キーワード検索 |

---

## 2. 商品検索DAO（ProductDAO）

### 分岐1: while (rs.next()) - search(String keyword)

| テストケースID | 分岐 | 入力条件 | 期待される実行パス | 期待結果 |
|---------------|------|----------|-------------------|----------|
| TC-BR-DAO-PROD-01 | true | 検索条件に一致する商品あり | whileブロック内を実行 | 商品リストが返される |
| TC-BR-DAO-PROD-02 | false | 検索条件に一致する商品なし | whileブロックをスキップ | 空リストが返される |

### 分岐2: while (rs.next()) - search(String keyword, int PRICE)

| テストケースID | 分岐 | 入力条件 | 期待される実行パス | 期待結果 |
|---------------|------|----------|-------------------|----------|
| TC-BR-DAO-PROD-03 | true | 名前と価格に一致する商品あり | whileブロック内を実行 | 商品リストが返される |
| TC-BR-DAO-PROD-04 | false | 名前と価格に一致する商品なし | whileブロックをスキップ | 空リストが返される |

---

## 3. カート追加処理（CartAddAction）

### 分岐1: if (cart==null)

| テストケースID | 分岐 | 入力条件 | 期待される実行パス | 期待結果 |
|---------------|------|----------|-------------------|----------|
| TC-BR-CART-01 | true | セッションにカートなし | 新規カートを作成 | カートが新規作成される |
| TC-BR-CART-02 | false | セッションにカートあり | 既存カートを使用 | 既存カートが使用される |

### 分岐2: if (i.getProduct().getId()==id)

| テストケースID | 分岐 | 入力条件 | 期待される実行パス | 期待結果 |
|---------------|------|----------|-------------------|----------|
| TC-BR-CART-03 | true | カート内に同じ商品あり | 数量を増やしてreturn | cart.jspへ遷移 |
| TC-BR-CART-04 | false | カート内に同じ商品なし | ループ続行 | 新規商品追加処理へ |

### 分岐3: if (p.getId()==id)

| テストケースID | 分岐 | 入力条件 | 期待される実行パス | 期待結果 |
|---------------|------|----------|-------------------|----------|
| TC-BR-CART-05 | true | 商品リストに該当商品あり | 新規Itemを作成して追加 | cart.jspへ遷移 |
| TC-BR-CART-06 | false | 商品リストに該当商品なし | ループ続行 | cart.jspへ遷移（追加なし） |

### 実行パス網羅

| 実行パス | 通過する分岐 | 入力条件 | 期待結果 |
|---------|-------------|----------|----------|
| パス1 | cart==null(true), id一致あり | 新規セッション、既存商品 | 数量増加 |
| パス2 | cart==null(true), id一致なし | 新規セッション、新規商品 | 新規追加 |
| パス3 | cart==null(false), id一致あり | 既存セッション、既存商品 | 数量増加 |
| パス4 | cart==null(false), id一致なし | 既存セッション、新規商品 | 新規追加 |

---

## 4. 購入処理（PurchaseAction）

### 分岐1: if (name.isEmpty() || address.isEmpty())

| テストケースID | 分岐 | 入力条件 | 期待される実行パス | 期待結果 |
|---------------|------|----------|-------------------|----------|
| TC-BR-PUR-01 | true | name=""またはaddress="" | エラーページへ | purchase-error-empty.jsp |
| TC-BR-PUR-02 | false | nameとaddressともに入力あり | 購入処理続行 | DB登録処理へ |

### 分岐2: if (cart==null || !flg)

| テストケースID | 分岐 | 入力条件 | 期待される実行パス | 期待結果 |
|---------------|------|----------|-------------------|----------|
| TC-BR-PUR-03 | true | cart=nullまたはDB登録失敗 | エラーページへ | purchase-error-insert.jsp |
| TC-BR-PUR-04 | false | cart!=nullかつDB登録成功 | カートをクリア | purchase-out.jsp |

### 実行パス網羅

| 実行パス | 通過する分岐 | 入力条件 | 期待結果 |
|---------|-------------|----------|----------|
| パス1 | name/address空(true) | 入力値なし | 空入力エラー |
| パス2 | name/address空(false), cart=null/flg=false(true) | 入力あり、カート空またはDB失敗 | 登録エラー |
| パス3 | name/address空(false), cart=null/flg=false(false) | 入力あり、カートあり、DB成功 | 購入完了 |

---

## 5. 購入DAO（PurchaseDAO）

### 分岐1: if (minPrice != null)

| テストケースID | 分岐 | 入力条件 | 期待される実行パス | 期待結果 |
|---------------|------|----------|-------------------|----------|
| TC-BR-DAO-PUR-01 | true | minPriceに値あり | SQLに価格下限条件追加 | 価格下限付き検索 |
| TC-BR-DAO-PUR-02 | false | minPrice=null | SQLに価格下限条件なし | 下限なし検索 |

### 分岐2: if (maxPrice != null)

| テストケースID | 分岐 | 入力条件 | 期待される実行パス | 期待結果 |
|---------------|------|----------|-------------------|----------|
| TC-BR-DAO-PUR-03 | true | maxPriceに値あり | SQLに価格上限条件追加 | 価格上限付き検索 |
| TC-BR-DAO-PUR-04 | false | maxPrice=null | SQLに価格上限条件なし | 上限なし検索 |

### 分岐3: if (productName != null && !productName.isEmpty())

| テストケースID | 分岐 | 入力条件 | 期待される実行パス | 期待結果 |
|---------------|------|----------|-------------------|----------|
| TC-BR-DAO-PUR-05 | true | productNameに値あり | SQLに商品名条件追加 | 商品名付き検索 |
| TC-BR-DAO-PUR-06 | false | productName=nullまたは空 | SQLに商品名条件なし | 商品名なし検索 |

### 分岐4: while (rs.next())

| テストケースID | 分岐 | 入力条件 | 期待される実行パス | 期待結果 |
|---------------|------|----------|-------------------|----------|
| TC-BR-DAO-PUR-07 | true | 検索条件に一致する購入あり | whileブロック内を実行 | 購入リストが返される |
| TC-BR-DAO-PUR-08 | false | 検索条件に一致する購入なし | whileブロックをスキップ | 空リストが返される |

### 分岐5: if (line!=1) - insertメソッド

| テストケースID | 分岐 | 入力条件 | 期待される実行パス | 期待結果 |
|---------------|------|----------|-------------------|----------|
| TC-BR-DAO-PUR-09 | true | DB登録失敗(line!=1) | ロールバックしてfalse返す | 登録失敗 |
| TC-BR-DAO-PUR-10 | false | DB登録成功(line==1) | ループ続行 | 登録続行 |

---

## 分岐網羅達成のための最小テストセット

### 商品検索処理
- **必要なテストケース数**: 2件
- **網羅率**: 100%

### カート追加処理  
- **必要なテストケース数**: 4件
- **網羅率**: 100%

### 購入処理
- **必要なテストケース数**: 3件
- **網羅率**: 100%

### ProductDAO
- **必要なテストケース数**: 4件
- **網羅率**: 100%

### PurchaseDAO
- **必要なテストケース数**: 8件
- **網羅率**: 100%

## 合計テストケース数
- **全体**: 21件のテストケースで全分岐網羅達成
- **網羅率**: 100%
